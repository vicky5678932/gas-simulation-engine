random patch start
added missing import
optimize gas calculation for edge cases
